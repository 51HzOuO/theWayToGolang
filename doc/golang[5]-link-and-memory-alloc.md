# golang快速入门[5]-go语言是如何运行的-谈链接器与内存分配

## 前文
* [golang快速入门[2.1]-go语言开发环境配置-windows](https://zhuanlan.zhihu.com/p/105462515)
* [golang快速入门[2.2]-go语言开发环境配置-macOS](https://zhuanlan.zhihu.com/p/105551487)
* [golang快速入门[2.3]-go语言开发环境配置-linux](https://zhuanlan.zhihu.com/p/105556890)
* [golang快速入门[3]-go语言helloworld](https://zhuanlan.zhihu.com/p/105776462)
* [golang快速入门[4]-go语言如何编译为机器码](https://zhuanlan.zhihu.com/p/106128892)

## 前言
* 在上一篇文章中,我们详细介绍了go语言编译为机器码经历的：词法分析 => 语法分析 => 类型检查 =>  中间代码 => 代码优化 => 生成机器码
* 但是在源代码生成执行程序的过程中，其实还经历了链接等过程。总的来说一个程序的生命周期可以概括为: 编写代码->编译->链接->加载到内存->执行
* 下面我们将对其进行逐一解释


## 链接(link)
* 我们编写的程序可能会使用其他程序或程序库( library ) 正如我们在helloworld程序中使用的fmt package
* 我们编写的程序必须与这些程序或程序库一起才能够执行
* 链接是将我们编写的程序与我们需要的外部程序组合在一起的过程
* 链接器是系统软件，在系统开发中起着至关重要的作用，因为它可以进行单独的编译。您可以将它分解为更小，更易管理的块，然后分别进行修改和编译，而不是将一个大型应用程序组织为一个整体的源文件。当您更改其中一个模块时，只需重新编译它并重新链接应用程序，而无需重新编译其他源文件。
* 链接分为两种，静态链接与动态链接
* go语言是典型的静态链接语言
* 静态链接的特点在于链接器会将程序中使用的所有库程序复制到最后的可执行文件中。而动态链接只会在最后的可执行文件中存储动态链接库的位置，并在运行时调用。
* 因此静态链接要更快，可移植，因为它不需要在运行它的系统上存在该库。但是在磁盘和内存上占用更多的空间
* 链接发生的过程会在两个地方，一种是静态链接在编译时发生，一种是动态链接在程序加载到内存时发生。go语言由于是静态链接的，所以链接发生的过程会是在编译时期的最后一个过程

* 下面我们简单对比一下静态链接与动态链接
| 静态链接                                                                                                                                                                                                           | 动态链接                                                                                                                                                                                           |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 静态链接是将程序中使用的所有库模块复制到最终可执行文件的过程,这是由链接器执行的，并且是编译过程的最后一步。 加载程序后，操作系统会将包含可执行代码和数据的单个文件放入内存,该静态链接文件包括调用程序和被调用程序. | 在动态链接中，外部库（共享库）的名称放置在最终的可执行文件中，而实际链接是在运行时将可执行文件和库都放置在内存中时进行的,动态链接使多个程序可以使用可执行模块的单个副本。                          |
| 静态链接由称为链接器的程序执行，是编译程序的最后一步                                                                                                                                                               | 动态链接由操作系统在运行时执行                                                                                                                                                                     |
| 静态链接文件的大小明显更大，因为外部程序内置在可执行文件中                                                                                                                                                         | 在动态链接中，共享库中只有一个副本保留在内存中。 这大大减小了可执行程序的大小，从而节省了内存和磁盘空间                                                                                            |
| 在静态链接中，如果任何外部程序已更改，则必须重新编译并重新链接它们，否则更改将不会反映在现有的可执行文件中                                                                                                         | 在动态链接中不同，只需要更新和重新编译各个共享模块程序即可变动。这是动态链接所提供的最大优势之一                                                                                                   |
| 静态链接的程序每次将其加载到内存中执行时，都会花费恒定的加载时间                                                                                                                                                   | 动态链接中，如果共享库代码已存在于内存中，则可以减少加载时间                                                                                                                                       |
| 使用静态链接库的程序通常比使用共享库的程序快                                                                                                                                                                       | 使用共享库的程序通常比使用静态链接库的程序要慢。                                                                                                                                                   |
| 在静态链接程序中，所有代码都包含在一个可执行模块中。 因此，它们永远不会遇到兼容性问题。                                                                                                                            | 动态链接的程序依赖于具有兼容的库。 如果更改了库（例如，新的编译器版本可能更改了库），则可能必须重新设计应用程序以使其与该库的新版本兼容。 如果从系统中删除了一个库，则使用该库的程序将不再起作用。 |
## 参考资料
* [作者知乎](https://www.zhihu.com/people/ke-ai-de-xiao-tu-ji-71)
* [blog](https://dreamerjonson.com/)